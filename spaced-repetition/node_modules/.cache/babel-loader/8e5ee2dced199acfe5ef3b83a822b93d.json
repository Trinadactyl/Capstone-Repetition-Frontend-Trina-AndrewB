{"ast":null,"code":"import _classCallCheck from \"/Users/andrewburchett/thinkful/capstone-repetition-frontend/spaced-repetition/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/andrewburchett/thinkful/capstone-repetition-frontend/spaced-repetition/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/andrewburchett/thinkful/capstone-repetition-frontend/spaced-repetition/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/andrewburchett/thinkful/capstone-repetition-frontend/spaced-repetition/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/andrewburchett/thinkful/capstone-repetition-frontend/spaced-repetition/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/andrewburchett/thinkful/capstone-repetition-frontend/spaced-repetition/src/contexts/UserContext.js\";\nimport React, { Component } from 'react';\nimport AuthApiService from '../services/auth-api-service';\nimport TokenService from '../services/token-service';\nimport IdleService from '../services/idle-service';\nvar UserContext = React.createContext({\n  user: {},\n  error: null,\n  setError: function setError() {},\n  clearError: function clearError() {},\n  setUser: function setUser() {},\n  processLogin: function processLogin() {},\n  processLogout: function processLogout() {}\n});\nexport default UserContext;\nexport var UserProvider =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(UserProvider, _Component);\n\n  function UserProvider(props) {\n    var _this;\n\n    _classCallCheck(this, UserProvider);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(UserProvider).call(this, props));\n\n    _this.setError = function (error) {\n      console.error(error);\n\n      _this.setState({\n        error: error\n      });\n    };\n\n    _this.clearError = function () {\n      _this.setState({\n        error: null\n      });\n    };\n\n    _this.setUser = function (user) {\n      _this.setState({\n        user: user\n      });\n    };\n\n    _this.processLogin = function (authToken) {\n      TokenService.saveAuthToken(authToken);\n      var jwtPayload = TokenService.parseAuthToken();\n\n      _this.setUser({\n        id: jwtPayload.user_id,\n        name: jwtPayload.name,\n        username: jwtPayload.sub\n      });\n\n      IdleService.regiserIdleTimerResets();\n      TokenService.queueCallbackBeforeExpiry(function () {\n        _this.fetchRefreshToken();\n      });\n    };\n\n    _this.processLogout = function () {\n      TokenService.clearAuthToken();\n      TokenService.clearCallbackBeforeExpiry();\n      IdleService.unRegisterIdleResets();\n\n      _this.setUser({});\n    };\n\n    _this.logoutBecauseIdle = function () {\n      TokenService.clearAuthToken();\n      TokenService.clearCallbackBeforeExpiry();\n      IdleService.unRegisterIdleResets();\n\n      _this.setUser({\n        idle: true\n      });\n    };\n\n    _this.fetchRefreshToken = function () {\n      AuthApiService.refreshToken().then(function (res) {\n        TokenService.saveAuthToken(res.authToken);\n        TokenService.queueCallbackBeforeExpiry(function () {\n          _this.fetchRefreshToken();\n        });\n      }).catch(function (err) {\n        _this.setError(err);\n      });\n    };\n\n    var state = {\n      user: {},\n      error: null\n    };\n\n    var _jwtPayload = TokenService.parseAuthToken();\n\n    if (_jwtPayload) state.user = {\n      id: _jwtPayload.user_id,\n      name: _jwtPayload.name,\n      username: _jwtPayload.sub\n    };\n    _this.state = state;\n    IdleService.setIdleCallback(_this.logoutBecauseIdle);\n    return _this;\n  }\n\n  _createClass(UserProvider, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      if (TokenService.hasAuthToken()) {\n        IdleService.regiserIdleTimerResets();\n        TokenService.queueCallbackBeforeExpiry(function () {\n          _this2.fetchRefreshToken();\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      IdleService.unRegisterIdleResets();\n      TokenService.clearCallbackBeforeExpiry();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var value = {\n        user: this.state.user,\n        error: this.state.error,\n        setError: this.setError,\n        clearError: this.clearError,\n        setUser: this.setUser,\n        processLogin: this.processLogin,\n        processLogout: this.processLogout\n      };\n      return React.createElement(UserContext.Provider, {\n        value: value,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }, this.props.children);\n    }\n  }]);\n\n  return UserProvider;\n}(Component);","map":{"version":3,"sources":["/Users/andrewburchett/thinkful/capstone-repetition-frontend/spaced-repetition/src/contexts/UserContext.js"],"names":["React","Component","AuthApiService","TokenService","IdleService","UserContext","createContext","user","error","setError","clearError","setUser","processLogin","processLogout","UserProvider","props","console","setState","authToken","saveAuthToken","jwtPayload","parseAuthToken","id","user_id","name","username","sub","regiserIdleTimerResets","queueCallbackBeforeExpiry","fetchRefreshToken","clearAuthToken","clearCallbackBeforeExpiry","unRegisterIdleResets","logoutBecauseIdle","idle","refreshToken","then","res","catch","err","state","setIdleCallback","hasAuthToken","value","children"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport AuthApiService from '../services/auth-api-service'\nimport TokenService from '../services/token-service'\nimport IdleService from '../services/idle-service'\n\nconst UserContext = React.createContext({\n  user: {},\n  error: null,\n  setError: () => {},\n  clearError: () => {},\n  setUser: () => {},\n  processLogin: () => {},\n  processLogout: () => {},\n})\n\nexport default UserContext\n\nexport class UserProvider extends Component {\n  constructor(props) {\n    super(props)\n    const state = { user: {}, error: null }\n\n    const jwtPayload = TokenService.parseAuthToken()\n\n    if (jwtPayload)\n      state.user = {\n        id: jwtPayload.user_id,\n        name: jwtPayload.name,\n        username: jwtPayload.sub,\n      }\n\n    this.state = state;\n    IdleService.setIdleCallback(this.logoutBecauseIdle)\n  }\n\n  componentDidMount() {\n    if (TokenService.hasAuthToken()) {\n      IdleService.regiserIdleTimerResets()\n      TokenService.queueCallbackBeforeExpiry(() => {\n        this.fetchRefreshToken()\n      })\n    }\n  }\n\n  componentWillUnmount() {\n    IdleService.unRegisterIdleResets()\n    TokenService.clearCallbackBeforeExpiry()\n  }\n\n  setError = error => {\n    console.error(error)\n    this.setState({ error })\n  }\n\n  clearError = () => {\n    this.setState({ error: null })\n  }\n\n  setUser = user => {\n    this.setState({ user })\n  }\n\n  processLogin = authToken => {\n    TokenService.saveAuthToken(authToken)\n    const jwtPayload = TokenService.parseAuthToken()\n    this.setUser({\n      id: jwtPayload.user_id,\n      name: jwtPayload.name,\n      username: jwtPayload.sub,\n    })\n    IdleService.regiserIdleTimerResets()\n    TokenService.queueCallbackBeforeExpiry(() => {\n      this.fetchRefreshToken()\n    })\n  }\n\n  processLogout = () => {\n    TokenService.clearAuthToken()\n    TokenService.clearCallbackBeforeExpiry()\n    IdleService.unRegisterIdleResets()\n    this.setUser({})\n  }\n\n  logoutBecauseIdle = () => {\n    TokenService.clearAuthToken()\n    TokenService.clearCallbackBeforeExpiry()\n    IdleService.unRegisterIdleResets()\n    this.setUser({ idle: true })\n  }\n\n  fetchRefreshToken = () => {\n    AuthApiService.refreshToken()\n      .then(res => {\n        TokenService.saveAuthToken(res.authToken)\n        TokenService.queueCallbackBeforeExpiry(() => {\n          this.fetchRefreshToken()\n        })\n      })\n      .catch(err => {\n        this.setError(err)\n      })\n  }\n\n  render() {\n    const value = {\n      user: this.state.user,\n      error: this.state.error,\n      setError: this.setError,\n      clearError: this.clearError,\n      setUser: this.setUser,\n      processLogin: this.processLogin,\n      processLogout: this.processLogout,\n    }\n    return (\n      <UserContext.Provider value={value}>\n        {this.props.children}\n      </UserContext.Provider>\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}